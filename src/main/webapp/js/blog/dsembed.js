!function(a9,aR,aS){function bd(){return bb.short_name?a6+"//"+bb.short_name+"."+ai.DOMAIN:ai.REMOTE}function a4(){function a(){for(var e;e=aM.shift();){var c=e.url,d=new b(e.title,{dir:"auto",icon:e.iconUrl,body:e.body});try{d.onclick=function(){a9.focus(),a5.href=c,d.close()}}catch(f){}setTimeout(function(){d.close&&d.close()},8000)}}var b=a9.Notification;"Notification" in a9&&"denied"!==b.permission&&("granted"===b.permission&&a(),b.requestPermission(function(c){"granted"===c&&a()}))}function aT(){return 0==a2.data.user_id}function aY(a){ai.theme=a,"none"!=a&&aX.injectStylesheet(ai.STATIC_URL+"/styles/embed"+(a?"."+a+".css?"+aE[a]:"."+short_name)+".css")}var aX={},ba=aR.getElementsByTagName("head")[0]||aR.getElementsByTagName("body")[0];if(aX.extend=function(c,a){for(var b in a){c[b]=a[b]}return c},aX.injectScript=function(b,c){var d=aR.createElement("script"),e=aR.head||aR.getElementsByTagName("head")[0]||aR.documentElement;d.type="text/javascript",d.src=b,d.async="async",d.charset="utf-8",c&&(d.onload=d.onreadystatechange=function(g,f){var h=f||!d.readyState||/loaded|complete/.test(d.readyState);h&&(d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=aS,f||c.call(a9))}),e.insertBefore(d,e.firstChild)},aX.injectStylesheet=function(b){var a=aR.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=b,ba.appendChild(a)},aX.injectStyle=function(b){var a=aR.createElement("style");return a.type="text/css",ba.appendChild(a),b=b.replace(/\}/g,"}\n"),a.styleSheet?a.styleSheet.cssText=b:a.appendChild(aR.createTextNode(b)),a},aX.getCookie=function(g){for(var b,c,f,k=" "+g+"=",j=aR.cookie.split(";"),h=0;h<j.length;h++){if(b=" "+j[h],c=b.indexOf(k),c>=0&&c+k.length==(f=b.indexOf("=")+1)){return decodeURIComponent(b.substring(f,b.length).replace(/\+/g,""))}}return aS},aX.param=function(d){var c=[];for(var b in d){d[b]!=aS&&c.push(b+"="+encodeURIComponent(d[b]))}return c.join("&")},aX.cssProperty=function(g,d){var b=(aR.body||aR.documentElement).style;if("undefined"==typeof b){return !1}if("string"==typeof b[g]){return d?g:!0}for(var c=["Moz","Webkit","ms"],g=g.charAt(0).toUpperCase()+g.substr(1),f=0;f<c.length;f++){if("string"==typeof b[c[f]+g]){return d?c[f]+g:!0}}},!a9.DUOSHUO){for(var a0 in Object.prototype){return alert("Object.prototype 不为空，请不要给 Object.prototype 设置方法")}var bb,aQ,aW=a9.JSON,a5=a9.location,a8=a9.XMLHttpRequest,aZ=aW&&aW.stringify&&a9.localStorage,aP=a9.navigator.userAgent,a6="https:"==aR.location.protocol?"https:":"http:",bc=0,aM=[],be=aQ=function(){function f(a){return c[a]||"&amp;"}var c={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},d=/&(?!\w+;)|[<>"'`]/g,b=/[&<>"'`]/;return function(a){return null==a||a===!1?"":b.test(a)?a.replace(d,f):a}}(),a1=function(b){if(b.match(/^(http|https):/)){return b}var a=aR.createElement("a");return a.href=b,am.hrefNormalized?a.href:a.getAttribute("href",4)},aO=function(a){return function(){return a}},aN=function(){for(var c={},a=0;a<arguments.length;a++){arguments[a]&&aX.extend(c,arguments[a])}var b=aX.param(c);return b?"?"+b:""},ag=function(){var a=aX.getCookie("duoshuo_token");return a?{jwt:a}:bb.remote_auth?{short_name:bb.short_name,remote_auth:bb.remote_auth}:aS},aU=function(){if(!bb&&(bb=a9.duoshuoQuery)){if(!bb.short_name||"your_duoshuo_short_name"===bb.short_name){return bb=aS,void alert("你还没有设置多说域名(duoshuoQuery.short_name)，填入已有域名或创建新站点：http://duoshuo.com/create-site/")}aG.trigger("queryDefined")}return bb},aC=function(a){return a&&a.error&&a.warn?a:{error:function(){},log:function(){},warn:function(){}}}(a9.console),ai=a9.DUOSHUO={sourceName:{weibo:"新浪微博",qq:"QQ",qzone:"QQ空间",qqt:"腾讯微博",renren:"人人网",douban:"豆瓣网",kaixin:"开心网",sohu:"搜狐微博",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},serviceNames:{weibo:"微博",qq:"QQ",douban:"豆瓣",renren:"人人",kaixin:"开心",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},parseDate:function(a){return a.parse("2011-10-28T00:00:00+08:00")&&function(b){return new a(b)}||a.parse("2011/10/28T00:00:00+0800")&&function(b){return new a(b.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||a.parse("2011/10/28 00:00:00+0800")&&function(b){return new a(b.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(b){return new a(b)}}(Date),fullTime:function(b){var a=ai.parseDate(b);return a.getFullYear()+"年"+(a.getMonth()+1)+"月"+a.getDate()+"日 "+a.toLocaleTimeString()},elapsedTime:function(f){var c=ai.parseDate(f),d=new Date,b=(d-bc-c)/1000;return 10>b?"刚刚":60>b?Math.round(b)+"秒前":3600>b?Math.round(b/60)+"分钟前":86400>b?Math.round(b/3600)+"小时前":(d.getFullYear()==c.getFullYear()?"":c.getFullYear()+"年")+(c.getMonth()+1)+"月"+c.getDate()+"日"},compileStyle:function(f){var c="",d={};if(d.textbox="#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper",!f){return c}for(var b in f){c+=d[b]+"{"+f[b]+"}\n"}return c},init:function(b,a){b&&!an[b]&&(an[b]=a||{type:"EmbedThread"}),ai.initView&&ai.initView()}},a3=aR.all,am=ai.support=function(){var d=aR.createElement("div");d.innerHTML='<a href="/a" style="opacity:.55;">a</a><input type="checkbox"/>';var b=d.getElementsByTagName("a")[0],c=d.getElementsByTagName("input")[0],e={placeholder:"placeholder" in c,touch:"ontouchstart" in a9||"onmsgesturechange" in a9,opacity:/^0.55$/.test(b.style.opacity),hrefNormalized:"/a"===b.getAttribute("href"),iOS:aP.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:aP.match(/ \(Linux; U; Android /)};return e.ie6=!a8&&"undefined"==typeof d.style.maxHeight,e.authInWin=a9.postMessage&&a9.screen.width>800&&!e.iOS&&!e.android&&a5.origin,e}(),an=ai.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentComments"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"},".ds-share":{type:"ShareWidget"}},aA=ai.openDialog=function(a){return ai.dialog!==aS&&ai.dialog.el.remove(),ai.dialog=new ax.Dialog(aV.dialog(a)).open()},aq=ai.smilies={};ai.require=function(){function a(d){var c=af[d]?"?"+af[d]+".js":"";return ai.STATIC_URL+"/libs/"+d+".js"+c}var b={mzadxN:"undefined"!=typeof mzadxN};return"undefined"!=typeof jQuery&&jQuery.fn.jquery>="1.5"&&(b["embed.compat"]=!0,ai.jQuery=a9.jQuery),function(g,c){if("string"==typeof g){b[g]?c():aX.injectScript(a(g),function(){b[g]=!0,c()})}else{if("object"==typeof g){var d,f=!0;for(d=0;d<g.length;d++){(function(e){b[g[d]]||(f=!1,aX.injectScript(a(e),function(){b[e]=!0;for(var h=0;h<g.length;h++){if(!b[g[h]]){return}}c()}))})(g[d])}f&&c()}}}}();for(var ao=0,av=["EmbedThread","RecentComments","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"];ao<av.length;ao++){ai[av[ao]]=function(a){return function(b,c){c=c||{},c.type=a,b&&!an[b]&&(an[b]=c),ai.initSelector&&ai.initSelector(b,c)}}(av[ao]),ai["create"+av[ao]]=function(a){return function(d,b){var c=aR.createElement(d);for(var e in b){c.setAttribute("data-"+e,b[e])}return ai[a](c),c}}(av[ao])}ai.RecentCommentsWidget=ai.RecentComments;var aj=ai.API={ajax:function(p,z,j,a,b){function q(g){var d=g.getResponseHeader("Date");d&&(bc=new Date-new Date(d))}function f(r,m,n){var g,h,u,d=m;if(r>=200&&300>r||304===r){if(304===r){d="notmodified",u=!0}else{try{g=aW.parse(n),d="success",u=!0}catch(v){d="parsererror",h=v}}}else{h=d,(!d||r)&&(d="error",0>r&&(r=0));try{g=aW.parse(n)}catch(v){d="parsererror",h=v}}u?a&&a(g):"parseerror"===d?aC.error("解析错误: "+n):(aC.error("出错啦("+g.code+"): "+g.errorMessage),b&&b(g),g.errorTrace&&aC.error(g.errorTrace)),q(c)}var x=aX.getCookie("duoshuo_token");j=j||{},j.v=ai.version,x?j.jwt=x:bb.remote_auth&&(j.remote_auth=bb.remote_auth);var k=a8&&aW&&aW.parse;if(k){var c=new a8,w=!!c&&"withCredentials" in c;if(w){var o;return c.open(p,bd()+"/api/"+z+".json"+("GET"==p?"?"+aX.param(j):""),!0),c.withCredentials=!0,c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),c.send("GET"==p?null:aX.param(j)),o=function(u,l){var g,h,m,A;try{if(o&&(l||4===c.readyState)){if(o=aS,l){4!==c.readyState&&c.abort()}else{g=c.status,m=c.getAllResponseHeaders();try{A=c.responseText}catch(u){}try{h=c.statusText}catch(y){h=""}}}}catch(v){l||f(-1,v)}A&&f(g,h,A,m)},void (4===c.readyState?o():c.onreadystatechange=o)}}"GET"!=p&&(j._method="POST");var s="cb_"+Math.round(1000000*Math.random());aj[s]=function(d){switch(d.code){case 0:a&&a(d);break;default:b&&b(d),aC.error("出错啦("+d.code+"): "+d.errorMessage),d.errorTrace&&aC.error(d.errorTrace)}},j.callback="DUOSHUO.API['"+s+"']",aX.injectScript(bd()+"/api/"+z+".jsonp?"+aX.param(j))},get:function(f,c,d,b){return this.ajax("GET",f,c,d,b)},post:function(f,c,d,b){return this.ajax("POST",f,c,d,b)}},ap=ai.ws={messages:[],send:function(c){if(!("WebSocket" in a9&&aW)){return !1}var b=this;if(b.messages.push(aW.stringify(c)),!b.webSocket){var d="https:"===aR.location.protocol?"wss://ws.duoshuo.com:8202/":"ws://ws.duoshuo.com:8201/",e=b.webSocket=new WebSocket(d);e.onopen=function(){var f,a=1===e.readyState;if(a){for(;f=b.messages.shift();){e.send(f)}}},e.onmessage=function(j){try{var g=aW.parse(j.data)}catch(h){return}switch(g.type){case"post":for(var f,i=0;i<ai.pagelets.length;i++){f=ai.pagelets[i],f.threadId==g.thread_id&&f.onMessage(g)}break;case"notification":aM.push(g),a4()}},a9.addEventListener("beforeunload",function(){e.close()})}b.webSocket.onopen()}};ai.DOMAIN="duoshuo.com",ai.STATIC_URL=a6+"//static.duoshuo.com",ai.REMOTE=a6+"//duoshuo.com",ai.version="16.3.18";var aE={"default":"9b2a46a0",dark:"33f3a5ac",bluebox:"39a75d50",newhua:"706ba4eb",justflat:"9d72ec5a"},af={"embed.compat":"24f8ca3f",smilies:"921e8eda"},aB={post:"发布",posting:"正在发布",settings:"设置",reply:"回复",like:"顶",repost:"转发",report:"举报","delete":"删除",reply_to:"回复 ",reposts:"转发",comments:"评论",floor:"楼",latest:"最新",earliest:"最早",hottest:"最热",share_to:"分享到:",leave_a_message:"说点什么吧…",no_comments_yet:"还没有评论，沙发等你来抢",repost_reason:"请输入转发理由",hot_posts_title:"被顶起来的评论",comments_zero:"暂无评论",comments_one:"1条评论",comments_multiple:"{num}条评论",reposts_zero:"暂无转发",reposts_one:"1条转发",reposts_multiple:"{num}条转发",weibo_reposts_zero:"暂无新浪微博",weibo_reposts_one:"1条新浪微博",weibo_reposts_multiple:"{num}条新浪微博",qqt_reposts_zero:"暂无腾讯微博",qqt_reposts_one:"1条腾讯微博",qqt_reposts_multiple:"{num}条腾讯微博"},aL={get:function(a){return aZ?aZ[a]:void 0},save:function(c,a){if(aZ){try{aZ.removeItem(c),aZ[c]=aW.stringify(a),aZ.removeItem(c+":timestamp"),aZ[c+":timestamp"]=Math.floor((new Date-bc)/1000)}catch(b){}}}},ad=ai.loadRequire=function(a){if(a.visitor&&(!a2.data&&a.visitor.user_id&&a9.Notification&&ap.send({logged_user_id:a.visitor.user_id}),a2.reset(a.visitor)),a.site&&(aJ.reset(a.site),aL.save("ds_site_"+bb.short_name,a.site)),!ai.theme&&aJ.data.theme&&aY(aJ.data.theme),a.lang&&(aX.extend(aB,a.lang),aL.save("ds_lang_"+bb.short_name,a.lang)),a.stylesheets){for(var b=0;b<a.stylesheets.length;b++){aX.injectStylesheet(a.stylesheets[b])}}if(a.nonce&&(ai.nonce=a.nonce),a.style&&aX.injectStyle((a.style||"")+ai.compileStyle(bb.component_style)),a.unread&&aI.reset(a.unread),a.warnings){for(var b=0;b<a.warnings.length;b++){aC.warn(a.warnings[b])}}},aD=0,aw=ai.Class=function(){};aw.extend=function(f){function c(){!aD&&this.init&&this.init.apply(this,arguments)}aD=1;var d=new this;aD=0;for(var b in f){d[b]=f[b]}return c.prototype=d,c.prototype.constructor=c,c.extend=arguments.callee,c};var au=ai.Event=aw.extend({on:function(d,c){var b=this.handlers||(this.handlers={});return b[d]===aS&&(b[d]=[]),b[d].push(c),this},trigger:function(f,c){var d=(this.handlers||(this.handlers={}))[f];if(d){for(var b=0;b<d.length&&d[b].call(this,c)!==!1;b++){}}return this}}),al=ai.Widget=au.extend({init:function(b,a){this.el=b,this.options=a||{},this.render()},render:function(){},reset:function(){},load:function(b){switch(b.code){case 0:ad(b);var a=this.prepare(b);a.options=aX.extend(this.options,b.options),this.onload(a);break;default:this.onError(b)}},onload:function(a){this.el.html(aV[this.tmpl](a))},prepare:function(a){return a},onMessage:function(){},onError:function(a){aC.error("出错啦("+a.code+"): "+a.errorMessage),a.errorTrace&&aC.error(a.errorTrace)}}),ae=ai.Model=au.extend({init:function(a){this.data=a},reset:function(a){this.data=a,this.trigger("reset")},remove:function(a){this.data.splice(a,1),this.trigger("reset")},set:function(d,c){if(c===aS){for(var b in d){this.data[b]=d[b]}}else{this.data[d]=c}return this.trigger("reset"),this},toJSON:function(){return aX.extend({},this.data)}}),aK=ae.extend({toJSON:function(){return aX.extend({},this.data)}}),az=ae.extend({toJSON:function(){var a=aX.extend({},this.data);return a.theAuthor=aF[this.data.author_id]&&aF[this.data.author_id].data||this.data.author,a.parents=this.data.parents||[],a}}),ab=ae.extend({toJSON:function(){return aX.extend({},this.data)}}),ay=function(a){this.model=a};ay.prototype.set=function(b){for(var a in b){b[a]&&(this[a]?this[a].set(b[a]):this[a]=new this.model(b[a]))}},ay.prototype.get=function(c){for(var a=0,b=[];a<c.length;a++){b[a]=this[c[a]]}return b},ay.prototype.getJSON=function(c){for(var a=0,b=[];a<c.length;a++){this[c[a]]&&b.push(this[c[a]].toJSON())}return b};var aa={userUrl:function(a){return a.url},avatarUrl:function(a){if(document.location.protocol=="https:"){if(a.avatar_url){a.avatar_url=a.avatar_url.replace(/^http\:\/\//,"https://");a.avatar_url=a.avatar_url.replace(/himg\.bdimg\.com/,"o6868bpd3.qnssl.com");a.avatar_url=a.avatar_url.replace(/ds\.cdncache\.org/,"o68689m6x.qnssl.com");a.avatar_url=a.avatar_url.replace(/img\d+\.douban\.com/,"img2.doubanio.com");a.avatar_url=a.avatar_url.replace(/app\.qlogo\.cn/,"o686ueg7e.qnssl.com");a.avatar_url=a.avatar_url.replace(/tp\d+\.sinaimg\.cn/,"o6866kbat.qnssl.com")}else{aJ.data.default_avatar_url="https://o68689m6x.qnssl.com/avatar-50/912/233043.jpg"}}return a.avatar_url||aJ.data.default_avatar_url},loginUrl:function(b,a){return a||(a={}),bb.sso&&bb.sso.login&&(a.sso=1,a.redirect_uri=bb.sso.login),bd()+"/login/"+b+"/"+aN(a)},bindUrl:function(a){return bd()+"/bind/"+a+"/"+aN(bb.sso&&bb.sso.login?{sso:1,redirect_uri:bb.sso.login}:null,ag())},logoutUrl:function(){return bd()+"/logout/"+aN(bb.sso&&bb.sso.logout?{sso:1,redirect_uri:bb.sso.logout}:null)}},ac=["weixin","weibo","qq","renren"],ar=["douban","kaixin","baidu","google"],aV=ai.templates={userAnchor:function(a){return a.url?'<a rel="nofollow author" target="_blank" href="'+be(a.url)+'">'+be(a.name)+"</a>":be(a.name)},avatarImg:function(b,a){return'<img src="'+be(aa.avatarUrl(b,a))+'" alt="'+be(b.name)+'"'+(a?' style="width:'+a+"px;height:"+a+'px"':"")+"/>"},avatar:function(d,b){var c=aV.avatarImg(d,b),a=aa.userUrl(d);return a?'<a rel="nofollow author" target="_blank" href="'+be(a)+'" '+(d.user_id?" onclick=\"this.href='"+bd()+"/user-url/?user_id="+d.user_id+"';\"":"")+' title="'+be(d.name)+'">'+c+"</a>":c},timeText:function(a){return a?'<span class="ds-time" datetime="'+a+'" title="'+ai.fullTime(a)+'">'+ai.elapsedTime(a)+"</span>":""},timeAnchor:function(b,a){return b?'<a href="'+a+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+b+'" title="'+ai.fullTime(b)+'">'+ai.elapsedTime(b)+"</a>":""},serviceIcon:function(b,a){return'<a href="javascript:void(0)" class="ds-service-icon'+(a?"-grey":"")+" ds-"+b+'" data-service="'+b+'" title="'+ai.sourceName[b]+'"></a>'},poweredBy:function(a){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+be(a)+"</a></p>"},indicator:aO('<div id="ds-indicator"></div>'),waitingImg:aO('<div id="ds-waiting"></div>'),loginItem:function(c,a){var b=aa[a?"bindUrl":"loginUrl"](c);return'<li>    <a href="'+b+'" rel="nofollow" class="ds-service-link ds-'+c+'">'+ai.serviceNames[c]+(a2.data.social_uid[c]?' <span class="ds-icon ds-icon-ok"></span>':"")+"</a></li>"}},a7=function(c){var a=[];for(var b in c){a.push('<input type="hidden" name="'+b+'" value="'+be(c[b])+'" />')}return a.join("\n")};aV.commentList=function(h){var d="",f=h.list;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<li class="ds-comment',h.options.show_avatars&&(d+=" ds-show-avatars"),d+='" data-post-id="'+b.post_id+'">',h.options.show_avatars&&(d+='<div class="ds-avatar">'+aV.avatar(b.theAuthor,h.options.avatar_size)+"</div>"),d+='<div class="ds-meta">'+aV.userAnchor(b.theAuthor),h.options.show_time&&(d+=aV.timeText(b.created_at)),d+="</div>",d+=h.options.show_title?'<div class="ds-thread-title">在 <a href="'+aQ(b.thread.url)+'#comments">'+aQ(b.thread.title)+'</a> 中评论</div><div class="ds-excerpt">'+b.message+"</div>":'<a class="ds-excerpt" title="'+b.thread.title+' 中的评论" href="'+aQ(b.thread.url)+'#comments">'+b.message+"</a>",d+="</li>"}}return d},aV.ctxPost=function(b){var a="";return b.post&&(a+='<li class="ds-ctx-entry"',b.hidden&&(a+=' style="display:none"'),a+=' data-post-id="'+b.post.post_id+'"><div class="ds-avatar">'+aV.avatar(b.post.theAuthor||b.post.author)+'</div><div class="ds-ctx-body"><div class="ds-ctx-head">'+aV.userAnchor(b.post.theAuthor||b.post.author)+aV.timeAnchor(b.post.created_at,b.post.url),b.index>=0&&(a+='<div class="ds-ctx-nth" title="'+ai.fullTime(b.post.created_at)+'">'+(b.index+1)+aB.floor+"</div>"),a+='</div><div class="ds-ctx-content">'+b.post.message,b.index>=0&&(a+='　　　　　　　<div class="ds-comment-actions',b.post.vote>0&&(a+=" ds-post-liked"),a+='">'+aV.likePost(b.post)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+aB.repost+'</a><a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+aB.reply+"</a></div>"),a+="</div></div></li>"),a},aV["dialog-anonymous"]=function(h){var d='<h2>社交帐号登录</h2><div class="ds-icons-32">',f=h.services;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<a class="ds-'+b+'" href="'+aa.loginUrl(b)+'">'+ai.sourceName[b]+"</a>"}}return d+="</div>",h.options.deny_anonymous||(d+='<h2>作为游客留言</h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+aQ(a2.data.name)+'" required /><label for="ds-dialog-name">名字(必填)</label></div>',h.options.require_guest_email&&(d+='<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+aQ(a2.data.email)+'" required /><label for="ds-dialog-email">邮箱(必填)</label></div>'),h.options.require_guest_url&&(d+='<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+aQ(a2.data.url)+'" /><label for="ds-dialog-url">网址(可选)</label></div>'),d+='<button type="submit">发布</button></form>'),d},aV["dialog-ask-for-auth"]=function(){var a='<h2>社交帐号登录</h2><ul class="ds-service-list">'+aV.serviceList(ac)+'</ul><ul class="ds-service-list ds-additional-services">'+aV.serviceList(ar)+"</ul>";return a},aV["dialog-bind-more"]=function(){var a='<h2>绑定更多帐号</h2><ul class="ds-service-list">'+aV.serviceBindList(ac)+'</ul><ul class="ds-service-list ds-additional-services">'+aV.serviceBindList(ar)+'</ul><div style="clear:both"></div>';return a},aV["dialog-qrcode"]=function(b){var a='<h2>微信扫一扫，分享到朋友圈</h2><div class="ds-share-qrcode" style="text-align:center;"><img src="'+b.qrcode_url+'" alt="'+b.url+'"></div>';return a},aV["dialog-reposts"]=function(b){var a='<h2>转发到微博</h2><div class="ds-quote"><strong>@'+aQ(b.post.theAuthor.name)+"</strong>: "+b.post.message+"</div><form>"+a7({post_id:b.post.post_id})+'<div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+aQ(aB.repost_reason)+'">'+aQ(b.repostMessage)+'</textarea><pre class="ds-hidden-text"></pre>';return a+='</div><div class="ds-actions">',b.service?a+=a7({"service[]":b.service}):(a+='<label><input type="checkbox" name="service[]" value="weibo"',a2.data.social_uid.weibo&&(a+=' checked="checked"'),a+=' /><span class="ds-service-icon ds-weibo"></span>新浪微博</label><label><input type="checkbox" name="service[]" value="qqt"',a2.data.social_uid.qq&&(a+=' checked="checked"'),a+=' /><span class="ds-service-icon ds-qqt"></span>腾讯微博</label>'),a+='<button type="submit">'+aB.repost+"</button></div></form>"},aV.dialog=function(b){var a='<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+b+'</div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>社会化评论框</span></div><a class="ds-dialog-close" href="javascript:void(0)" title="关闭"></a></div></div>';return a},aV.hotPosts=function(h){var d='<div class="ds-header ds-gradient-bg">'+aQ(aB.hot_posts_title)+"</div><ul>",f=h.list;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+=aV.post({post:b,options:h.options})}}return d+="</ul>"},aV.likePost=function(b){var a='<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span>'+aB.like;return b.likes>0&&(a+="("+b.likes+")"),a+="</a>"},aV.likeTooltip=function(c){var a='<div class="ds-like-tooltip ds-rounded"><p>很高兴你能喜欢，分享一下吧：</p><ul>';for(var b in c.services){a+='<li><a class="ds-share-to-'+b+" ds-service-link ds-"+b+'" href="'+bd()+"/share-proxy/?"+aX.param({service:b,thread_id:c.thread_id})+'">'+c.services[b]+"</a></li>"}return a+='</ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">算了</a></p></div>'},aV.loginButtons=function(){var a='<div class="ds-login-buttons"><p>社交帐号登录:</p><div class="ds-social-links"><ul class="ds-service-list">'+aV.serviceList(ac)+'<li><a class="ds-more-services" href="javascript:void(0)">更多»</a></li></ul><ul class="ds-service-list ds-additional-services">'+aV.serviceList(ar)+"</ul></div></div>";return a},aV.loginWidget=function(h){var d='<div class="ds-icons-32">',f=h;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<a class="ds-'+b+'" href="'+aa.loginUrl(b)+'">'+ai.sourceName[b]+"</a>"}}return d+="</div>"},aV.meta=function(b){var a='<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded';return b.user_vote>0&&(a+=" ds-thread-liked"),a+='"><span class="ds-icon ds-icon-heart"></span> <span class="ds-thread-like-text">',a+=b.user_vote>0?"已喜欢":"喜欢",a+='</span><span class="ds-thread-cancel-like">取消喜欢</span></a><span class="ds-like-panel"></span></div>'},aV.notify=function(b){var a='<div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="多说"></a><ul class="ds-notify-unread"><li';return b.comments||(a+=' style="display:none;"'),a+='><a data-type="unread-comments" href="javascript:void(0);">你有'+b.comments+"条新回复</a></li><li",b.notifications||(a+=' style="display:none;"'),a+='><a data-type="unread-notifications" href="javascript:void(0);">你有'+b.notifications+"条系统消息</a></li></ul></div>"},aV.post=function(k){var u="",v=k.post,j=k.options,a=v.author;v.message=v.message.replace(/http:\/\/img\.t\.sinajs\.cn\//g,"https://o72ntwgk5.qnssl.com/");v.message=v.message.replace(/src=\"http\:\/\//,'src="https://');if(u+='<li class="ds-post" data-post-id="'+v.post_id+'"><div class="ds-post-self" data-post-id="'+v.post_id+'" data-thread-id="'+v.thread_id+'" data-root-id="'+v.root_id+'" data-source="'+v.source+'"><div class="ds-avatar"',a.user_id&&(u+=' data-user-id="'+a.user_id+'"'),u+=">"+aV.avatar(a),ai.sourceName[v.source]&&(u+=aV.serviceIcon(v.source)),u+='</div><div class="ds-comment-body"><div class="ds-comment-header">',a.url?(u+='<a class="ds-user-name ds-highlight" data-qqt-account="'+(a.qqt_account||"")+'" href="'+aQ(a.url)+'" ',a.user_id&&(u+=" onclick=\"this.href='"+bd()+"/user-url/?user_id="+a.user_id+"';\""),u+=' rel="nofollow" target="_blank"',a.user_id&&(u+=' data-user-id="'+a.user_id+'"'),u+=">"+aQ(a.name)+"</a>"):(u+='<span class="ds-user-name"',a.user_id&&(u+=' data-user-id="'+a.user_id+'"'),u+=' data-qqt-account="'+(a.qqt_account||"")+'">'+aQ(a.name)+"</span>"),u+="</div>",1==j.max_depth&&j.show_context&&v.parents.length){u+='<ol id="ds-ctx">';var g=aH.getJSON(v.parents);if(g){for(var f,m=-1,h=g.length-1;h>m;){f=g[m+=1],1==m&&v.parents.length>2&&(u+='<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand">还有'+(v.parents.length-2)+"条评论</a></li>"),u+=aV.ctxPost({post:f,index:m,hidden:m&&m<v.parents.length-1})}}u+="</ol>"}if(u+="<p>",v.parents.length>=j.max_depth&&(!j.show_context||j.max_depth>1)&&v.parent_id&&aH[v.parent_id]&&(u+='<a class="ds-comment-context" data-post-id="'+v.post_id+'" data-parent-id="'+v.parent_id+'">'+aB.reply_to+aQ(aH[v.parent_id].toJSON().author.name)+": </a>"),u+=v.message+'</p><div class="ds-comment-footer ds-comment-actions',v.vote>0&&(u+=" ds-post-liked"),u+='">',u+=v.url?aV.timeAnchor(v.created_at,v.url):aV.timeText(v.created_at),"duoshuo"==v.source?(u+='<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+aB.reply+"</a>"+aV.likePost(v)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+aB.repost+'</a><a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>'+aB.report+"</a>",v.privileges["delete"]&&(u+='<a class="ds-post-delete" href="javascript:void(0);"><span class="ds-icon ds-icon-delete"></span>'+aB["delete"]+"</a>")):("qqt"==v.source||"weibo"==v.source)&&(u+='<a class="ds-weibo-comments" href="javascript:void(0);">'+aB.comments,v.type.match(/\-comment$/)||(u+='(<span class="ds-count">'+v.comments+"</span>)"),u+='</a><a class="ds-weibo-reposts" href="javascript:void(0);">'+aB.reposts,v.type.match(/\-comment$/)||(u+='(<span class="ds-count">'+v.reposts+"</span>)"),u+="</a>"),u+="</div></div></div>",j.max_depth>1&&(v.childrenArray||v.children)&&"weibo"!=v.source&&"qqt"!=v.source){u+='<ul class="ds-children">';var q=aH.getJSON(v.childrenArray||v.children);if(q){for(var v,m=-1,b=q.length-1;b>m;){v=q[m+=1],u+=aV.post({post:v,options:j})}}u+="</ul>"}return u+="</li>"},aV.postListHead=function(b){var a='<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+aB.latest+'</a><a class="ds-order-asc">'+aB.earliest+'</a><a class="ds-order-hot">'+aB.hottest+'</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"></a></li>';return b.options.show_reposts&&b.thread.reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"></a></li>'),a+=" ",b.options.show_weibo&&b.thread.weibo_reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"></a></li>'),a+=" ",b.options.show_qqt&&b.thread.qqt_reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"></a></li>'),a+="</ul></div>"},aV.recentVisitors=function(h){var d="",f=h.response;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<div class="ds-avatar">'+aV.avatar(b,h.options.avatar_size)+"</div>"}}return d},aV["related-read"]=function(j){var p="";if(j&&j.length){p+='<article class="ds-reads-expand"><div class="ds-header">头条推荐</div><section> ';var q=j;if(q){for(var m,h=-1,b=q.length-1;b>h;){if(m=q[h+=1],p+=' <a href="'+m.url+'" class="ds-reads-item"> ',3==m.imgs.length){p+=" <h2>"+m.title+'</h2> <div class="ds-reads-pics"> <ul> ';var f=m.imgs;if(f){for(var c,k=-1,g=f.length-1;g>k;){c=f[k+=1],p+=' <li> <div class="ds-reads-dumb"></div> <div class="ds-reads-pic-wrap" style="background-image:url('+c+');"></div> </li> '}}p+=' </ul> </div> <div class="ds-reads-info"> ',1==m.type&&(p+=' <span class="ds-reads-app-special">打开头条阅读</span> '),p+=' <span class="ds-reads-date" data-date="'+m.timeStamp+'"></span> </div> '}else{p+=' <div class="ds-reads-desc ',m.imgs.length||(p+="ds-reads-only"),p+='"> <div class="ds-reads-title">'+m.title+'</div> <div class="ds-reads-info"> ',1==m.type&&(p+=' <span class="ds-reads-app-special">打开头条阅读</span> '),p+=' <span class="ds-reads-date" data-date="'+m.timeStamp+'"></span> </div> </div> ',m.imgs.length&&(p+=' <div class="ds-reads-pic-right"> <div class="ds-reads-dumb"></div> <div class="ds-reads-pic-wrap" style="background-image:url('+m.imgs[0]+');"> ',m.hasVideo&&(p+=' <div class="ds-reads-vid-info"><span>'+m.videoDuration+"</span></div> "),p+=" </div> </div> "),p+=" "}p+=" </a> "}}p+="</section></article>"}return p},aV.replybox=function(c){var a='<div class="ds-replybox"><a class="ds-avatar"';if(a+=aT()?' href="javascript:void(0);" onclick="return false"':' href="'+ai.REMOTE+"/settings/avatar/"+aN(ag())+'" target="_blank" title="设置头像"',a+=">"+aV.avatarImg(a2.data)+'</a><form method="post">'+a7(c.params)+'<div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+aQ(aB.leave_a_message)+'"></textarea><pre class="ds-hidden-text"></pre>',a+="</div>",a+='<div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync">',!aT()&&a2.data.repostOptions){a+='<input id="ds-sync-checkbox',c.inline&&(a+="-inline"),a+='" type="checkbox" name="repost" ',c.checked&&(a+='checked="checked" '),a+='value="'+c.repostArray.join(",")+'"> <label for="ds-sync-checkbox',c.inline&&(a+="-inline"),a+='">'+aB.share_to+"</label>";for(var b in a2.data.repostOptions){a+=aV.serviceIcon(b,!a2.data.repostOptions[b])}}return a+="</span>",a+="</div>",a+='<button class="ds-post-button" type="submit">'+aQ(aB.post)+'</button><div class="ds-toolbar-buttons">',c.options.use_smilies&&(a+='<a class="ds-toolbar-button ds-add-emote" title="插入表情"></a>'),c.options.use_images&&c.options.parse_html_enabled&&(a+='<a class="ds-toolbar-button ds-add-image" title="插入图片"></a>'),a+="</div></div>",a+="</form></div>"},aV.serviceBindList=function(h){var d="",f=h;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<li><a href="'+aa.bindUrl(b)+'" rel="nofollow" class="ds-service-link ds-'+b+'">'+ai.serviceNames[b],a2.data.social_uid[b]&&(d+=' <span class="ds-icon ds-icon-ok"></span>'),d+="</a></li>"}}return d},aV.serviceList=function(h){var d="",f=h;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<li><a href="'+aa.loginUrl(b)+'" rel="nofollow" class="ds-service-link ds-'+b+'">'+ai.serviceNames[b]+"</a></li>"}}return d},aV.shareWidget=function(h){var d='<div class="ds-share-icons"> <div class="ds-share-icons-inner"> <ul class="ds-share-icons-16"> ',f=h.services;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+=' <li> <a class="ds-'+b+'" href="javascript:void(0);" data-service="'+b+'">'+ai.sourceName[b]+"</a> </li> "}}return d+=' </ul> </div> <div class="ds-share-icons-footer">'+h.copyright+"</div></div>"},aV.smiliesTooltip=function(c){var a='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">';for(var b in c){a+="<li><a>"+b+"</a></li>"}return a+='</ul><div class="ds-smilies-container"></div></div>'},aV.toolbar=function(){var a='<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"></span> <span>帐号管理</span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">绑定更多</a></li><li><a target="_blank" href="'+ai.REMOTE+"/settings/"+aN(ag())+'">'+aQ(aB.settings)+'</a></li><li><a rel="nofollow" href="'+aa.logoutUrl()+'" style="border-bottom: none">登出</a></li></ul></div><div class="ds-visitor">';return a+=a2.data.url?'<a class="ds-visitor-name" href="'+aQ(a2.data.url)+'" target="_blank">'+aQ(a2.data.name)+"</a>":'<span class="ds-visitor-name">'+aQ(a2.data.name)+"</span>",a+='<a class="ds-unread-comments-count" href="javascript:void(0);" title="新回复"></a></div></div>'},aV.topThreads=function(h){var d="",f=h.response;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<li><a target="_blank" href="'+aQ(b.url)+'" title="'+aQ(b.title)+'">'+aQ(b.title)+"</a></li>"}}return d},aV.topUsers=function(h){var d="",f=h.response;if(f){for(var b,c=-1,g=f.length-1;g>c;){b=f[c+=1],d+='<div class="ds-avatar">'+aV.avatar(b,h.options.avatar_size)+"<h4>"+aQ(b.name)+"</h4></div>"}}return d},aV.userInfo=function(c){var a='<a href="'+aQ(c.url)+'" onclick="this.href=\''+bd()+"/user-url/?user_id="+c.user_id+'\';" class="ds-avatar" target="_blank">'+aV.avatarImg(c)+'</a><a href="'+aQ(c.url)+'" onclick="this.href=\''+bd()+"/user-url/?user_id="+c.user_id+'\';" class="ds-user-name ds-highlight" target="_blank">'+aQ(c.name)+"</a>";for(var b in c.social_uid){a+='<a href="'+ai.REMOTE+"/user-proxy/"+b+"/"+c.social_uid[b]+'/" target="_blank" class="ds-service-icon ds-'+b+'" title="'+ai.sourceName[b]+'"></a>'}return a+='<p class="ds-user-card-meta"><a href="'+ai.REMOTE+"/profile/"+c.user_id+'/" target="_blank"><span class="ds-highlight">'+c.comments+"</span>条评论</a></p>",c.description&&(a+='<p class="ds-user-description">'+aQ(c.description)+"</p>"),a};var ax=ai.Views={},ah=(ai.Callbacks={},ai.pagelets=[]),aG=ai.events=new au,aJ=ai.site=new ae,a2=ai.visitor=new aK,aI=ai.unread=new ae,ak=ai.threadPool=new ay(ab),aH=ai.postPool=new ay(az),aF=ai.userPool=new ay(aK);aG.on("queryDefined",function(){var c=bb.short_name;if(bb.theme&&aY(bb.theme),aZ){var a=aZ["ds_site_"+c],b=aZ["ds_lang_"+c];a&&aJ.reset(aW.parse(a)),b&&aX.extend(aB,aW.parse(b))}}),aU(),ai.require("embed.compat",function(){function M(b){b.stopPropagation()}function J(b){(b.ctrlKey&&13==b.which||10==b.which)&&t(this.form).trigger("submit")}function Q(){var b=t(this);b.height(Math.max(54,b.next(".ds-hidden-text").text(this.value).height()+27))}function L(){if(am.authInWin){var b=this.href.match(/\/(login|bind)\/(\w+)\//i);if(b&&ai.serviceNames[b[2]]){return !R(b[2],this.href)}}}function C(){var p,g,b,f,l,x=this,w=0,u=0;aR.selection&&(g=aR.selection.createRange(),g&&g.parentElement()==x&&(f=x.value.length,p=x.value.replace(/\r\n/g,"\n"),b=x.createTextRange(),b.moveToBookmark(g.getBookmark()),l=x.createTextRange(),l.collapse(!1),b.compareEndPoints("StartToEnd",l)>-1?w=u=f:(w=-b.moveStart("character",-f),w+=p.slice(0,w).split("\n").length-1,b.compareEndPoints("EndToEnd",l)>-1?u=f:(u=-b.moveEnd("character",-f),u+=p.slice(0,u).split("\n").length-1)))),t(x).data("ds-range-start",w).data("ds-range-end",u)}function F(b){return am.touch&&b.addClass("ds-touch"),aX.cssProperty("transition")||b.addClass("ds-no-transition"),am.ie6&&b.addClass("ds-ie6"),am.opacity||b.addClass("ds-no-opacity"),b}function P(d){if(!am.placeholder){var b=d.attr("placeholder");d.val(b).focus(function(){this.value===b&&(this.value="")}).blur(function(){""===this.value&&(this.value=b)})}return d}function O(b){if("http://duoshuo.com"===b.origin){switch(b.data.type){case"login":a5.href=b.data.redirectUrl}}}function R(d,f){var b={weibo:[760,600],renren:[420,322],qq:[504,445],weixin:[450,550],google:[600,440]}[d]||[550,400];return a9.open(f+(-1==f.indexOf("?")?"?":"&")+aX.param({origin:a5.origin||"http://"+a5.host}),"_blank","width="+b[0]+",height="+b[1]+",toolbar=no,menubar=no,location=yes")}function q(d){var b=aa[aT()?"loginUrl":"bindUrl"](d);am.authInWin&&R(d,b)||(a5.href=b)}function v(){var b=aA(aV["dialog-ask-for-auth"]({})).el.find(".ds-dialog").css("width","300px");b.find("a.ds-service-link").click(L)}function s(u,g,n,d){function f(){function i(A){if(n&&d){var x=n.options,l=E(n.postList.el,A.response[d],x);"asc"==x.order==("top"==x.formPosition)&&ai.scrollTo(l);var y=n.el.find(".ds-comments-tab-"+d+" span.ds-highlight");y.html(parseInt(y.html())+1)}}return d||b.find("[type=checkbox]:checked")[0]?(aj.post("posts/repost",ai.toJSON(b),i),w.close(),!1):(alert("还没有选发布到哪儿呢"),!1)}function p(){var i=this.value;return this.checked&&!a2.data.social_uid["qqt"==i?"qq":i]?void q(i):void 0}var w=aA(aV["dialog-reposts"]({post:u.toJSON(),repostMessage:g,service:d})),b=w.el.find("form");return b.submit(f),b.find(".ds-actions [type=checkbox]").change(p),P(b.find("textarea")).keyup(J).keyup(Q).focus(),!1}function j(g){var d={"unread-comments":{title:"新留言及回复",apiUrl:"users/unreadComments",tmpl:function(i){return i.thread?'<li data-thread-id="'+i.thread.thread_id+'">'+t.map(i.authors,aV.userAnchor).join("、")+' 在 <a class="ds-read" href="'+i.thread.url+'#comments" target="_blank">'+be(i.thread.title||"无标题")+'</a> 中回复了你 <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>':""},read:function(l){var i=l.attr("data-thread-id");aj.post("threads/read",{thread_id:i}),aI.data.comments--}},"unread-notifications":{title:"系统消息",apiUrl:"users/unreadNotifications",tmpl:function(i){return'<li data-notification-id="'+i.notification_id+'" data-notification-type="'+i.type+'">'+i.content+' <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>'},read:function(l){var i=l.attr("data-notification-id");aj.post("notifications/read",{notification_id:i}),aI.data.notifications--}}}[g],f=aA("<h2>"+d.title+'</h2><ul class="ds-unread-list"></ul>');f.on("close",ai.resetNotify);var b=f.el.find(".ds-unread-list").delegate(".ds-delete","click",function(){return t(this).parent().remove(),0===b.children().length&&f.close(),!1}).delegate(".ds-read","click",function(){d.read(t(this).parent())});t("#ds-notify").hide(),aj.get(d.apiUrl,{},function(i){f.el.find(".ds-unread-list").html(t.map(i.response,d.tmpl).join("\n"))})}function m(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)}function r(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0,c.detach()},400)}function E(f,b,d){return f.find(".ds-post[data-post-id="+b.data.post_id+"]")[0]?void 0:(f.find(".ds-post-placeholder").remove(),t(aV.post({post:b.toJSON(),options:d})).hide()["asc"==d.order?"appendTo":"prependTo"](f).slideDown(function(){}))}function h(A,K){function N(){if(aT()){return v(),!1}var n=t(this).parent(),i=n.hasClass("ds-post-liked"),l=t(this).html().match(/\((\d+)\)/),d=(l?parseInt(l[1]):0)+(i?-1:1);return aj.post("posts/vote",{post_id:n.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:i?0:1}),t(this).html(t(this).html().replace(/\(\d+\)/,"")+(d?"("+d+")":"")),n[i?"removeClass":"addClass"]("ds-post-liked"),!1}function H(){var i=t(this).closest(".ds-post-self"),d=aH[i.attr("data-post-id")];return s(d,""),!1}function x(){if(!confirm("确定要删除这条评论吗？")){return !1}var d=t(this).closest(".ds-post-self");return aj.post("posts/remove",{post_id:d.attr("data-post-id")}),d.parent().fadeOut(200,function(){A.data.comments--,A.updateCounter("duoshuo"),t(this).remove()}),!1}function g(){if(!confirm("确定要举报这条评论吗？")){return !1}var d=t(this).closest(".ds-post-self");return aj.post("posts/report",{post_id:d.attr("data-post-id")}),alert("感谢您的反馈！"),!1}function f(){var n=t(this),d=n.closest(".ds-comment-actions");if(d.hasClass("ds-reply-active")){y.el.fadeOut(200,function(){t(this).detach()}),d.removeClass("ds-reply-active")}else{var l=n.closest(".ds-ctx-entry, .ds-post-self");y?y.actionsBar.removeClass("ds-reply-active"):(y=new ax.Replybox(A),y.render(!0).el.addClass("ds-inline-replybox").detach()),y.el.find("[name=parent_id]").val(l.attr("data-post-id")),y.el.show().appendTo(n.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus(),y.actionsBar=d.addClass("ds-reply-active"),K.max_depth<=1?y.postList=A.postList.el:(y.postList=l.siblings(".ds-children"),y.postList[0]||(y.postList=t('<ul class="ds-children"></ul>').insertAfter(l)))}return !1}function B(){function p(i){ad(i),l.append(t.map(i.response,function(u){return aV.post({post:u,options:K})}).join(""))}var n=t(this).closest(".ds-post-self"),d=n.attr("data-post-id");n.data("source");if(0!=n.attr("data-root-id")){return !1}var l=n.siblings(".ds-children");return l[0]?(l.remove(),!1):(l=t('<ul class="ds-children"></ul>').insertAfter(n),aj.get("posts/listComments",D({post_id:d}),p),!1)}function w(){var p=t(this).closest(".ds-post-self"),u=aH[p.attr("data-post-id")],d=u.data.source;if(!a2.data.social_uid["qqt"==d?"qq":d]){return void q(d)}var l=u.data.root_id,S="0"!=l?aH[l]:u,U="";if("0"!=l){var T=prepatePost(u.data).theAuthor;U=("weibo"==d?"//@"+T.name:"|| @"+T.qqt_account)+":"+u.data.message}return s(S,U,A,d),!1}function G(){var d=t(this).parent();return d.siblings().show(),d.remove(),!1}function I(){function i(){function Z(u){var n=u.response;aF[X]?aF[X].set(n):aF[X]=new aK(n),c.owner==l&&o.html(aV.userInfo(n))}a=0,c.owner=l,m();var V=d.offset(),p=A.el.offset(),T=d.innerWidth()/2,S=A.el.innerHeight()-(V.top-p.top)+6,W=V.left-p.left-35+(T>35?35:T);try{if(d.hasClass("ds-comment-context")){o.attr("id","ds-ctx-bubble").attr("data-post-id",d.attr("data-post-id")).html('<ul id="ds-ctx">'+aV.ctxPost({post:aH[d.attr("data-parent-id")].toJSON()})+'</ul><div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);">查看对话</a></div>')}else{if(d.hasClass("ds-avatar")||d.hasClass("ds-user-name")){var U={},X=U.user_id=d.attr("data-user-id");if(!X){throw"no info"}o.attr("id","ds-user-card").attr("data-user-id",X).empty(),aF[X]?o.html(aV.userInfo(aF[X].data)):aj.get("users/profile",D(U),Z)}}c.css({bottom:S,left:W}).appendTo(A.innerEl)}catch(Y){c.detach()}}var l=this;if(bubbleOutTimer&&c.owner==l){return clearTimeout(bubbleOutTimer),void (bubbleOutTimer=0)}var d=t(l);a=setTimeout(i,200)}function b(){a?(clearTimeout(a),a=0):bubbleOutTimer||r()}var y;this.delegate("a.ds-post-likes","click",N).delegate("a.ds-post-repost","click",H).delegate("a.ds-post-delete","click",x).delegate("a.ds-post-report","click",g).delegate("a.ds-post-reply","click",f).delegate("a.ds-weibo-comments","click",B).delegate("a.ds-weibo-reposts","click",w).delegate("a.ds-expand","click",G),am.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",I).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",b)}function D(f){var d={require:"site,visitor,nonce,lang"+(k++?"":",unread,log,extraCss"),site_ims:aL.get("ds_site_"+bb.short_name+":timestamp"),lang_ims:aL.get("ds_lang_"+bb.short_name+":timestamp"),referer:aR.referrer};bb.stylePatch&&(d.style_patch=bb.stylePatch);for(var b in d){d[b]&&(!am.ie6||encodeURIComponent(d[b]).length<200)&&(f[b]=d[b])}return f}var t=ai.jQuery,e=t(a9),z=t(aR);a9.postMessage&&(a9.addEventListener?a9.addEventListener("message",O,!1):a9.attachEvent&&a9.attachEvent("onmessage",O)),ai.scrollTo=function(d){var b=d.offset().top;(b<e.scrollTop()||b>e.scrollTop()+e.height())&&t("html, body").animate({scrollTop:b-40},200,"swing")},ai.toJSON=function(n){var f=/\r?\n/g,g=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,b=/^(?:select|textarea)/i,d=n.map(function(){return this.elements?t.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||b.test(this.nodeName)||g.test(this.type))}).map(function(u,p){var i=t(this).val();return null==i?null:t.isArray(i)?t.map(i,function(w){return{name:p.name,value:w.replace(f,"\r\n")}}):{name:p.name,value:i.replace(f,"\r\n")}}).toArray(),l={};return t.each(d,function(){l[this.name]=this.value}),l},ai.resetNotify=function(){var d=t("#ds-notify"),b=aI.data;d[0]||(d=t('<div id="ds-notify"></div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[aJ.data.notify_position]).delegate(".ds-notify-unread a","click",function(){return j(t(this).data("type")),!1}).appendTo(aR.body)),d.html(aV.notify(b))[!b.comments&&!b.notifications||"hidden"===aJ.data.notify_position||t(".ds-dialog")[0]?"hide":"show"]()},aI.on("reset",ai.resetNotify),ax.Replybox=function(b){this.embedThread=b},ax.Replybox.prototype={render:function(W){function A(b){b.data("submitting",!0),b.find(".ds-post-button").addClass("ds-waiting").html(aB.posting)[0].disabled=!0}function Z(b){b.data("submitting",!1),b.find(".ds-post-button").removeClass("ds-waiting").html(aB.post)[0].disabled=!1}var S=this,I=S.embedThread,X=I.options,H=function(){ai.require("smilies",function(){})},U={thread:I,options:X,inline:W,params:{thread_id:I.threadId,parent_id:"",nonce:ai.nonce},repostArray:[],checked:0};for(var u in a2.data.repostOptions){a2.data.repostOptions[u]&&(U.repostArray.push(u),U.checked=1)}var V=S.el=t(aV.replybox(U)).click(H),Y=V.find("form"),f=Y.find("input[type=checkbox]")[0],at=Y.find("a.ds-service-icon, a.ds-service-icon-grey"),K=P(Y.find("textarea")).focus(H).keyup(J).keyup(Q).bind("focus mousedown mouseup keyup",C),n=V.find(".ds-add-emote").click(function(g){var b=ai.smiliesTooltip;return n.toggleClass("ds-expanded").hasClass("ds-expanded")?(b||(b=ai.smiliesTooltip=new ax.SmiliesTooltip,b.render(),ai.require("smilies",function(){b.reset("微博-默认")})),b.replybox=S,b.el.appendTo(aR.body).css({top:S.el.offset().top+S.el.outerHeight()+4+"px",left:S.el.find(".ds-textarea-wrapper").offset().left+"px"}),t(aR.body).click(l)):l(g),!1}),l=(V.find(".ds-add-image").click(function(x){var p=K[0],b=p.value,g="请输入图片地址",w='<img src="'+g+'" />';if(aR.selection){p.value=b.substring(0,K.data("ds-range-start"))+w+b.substring(K.data("ds-range-end"),b.length),p.value=p.value.replace("说点什么吧 ...",""),p.focus();var T=aR.selection.createRange();T.collapse(),T.findText(g),T.select()}else{p.value=b.substring(0,p.selectionStart)+w+b.substring(p.selectionEnd);var y=p.value.search(g);p.setSelectionRange(y,y+g.length),p.focus()}x.preventDefault()}),S.hideSmilies=function(){n.removeClass("ds-expanded"),ai.smiliesTooltip.el.detach(),t(aR.body).unbind("click",l)}),d=function(x,p){var w=aA(aV["dialog-anonymous"]({services:["weixin","weibo","qq","renren","kaixin","douban"],options:X})),b=w.el.find(".ds-dialog").css("width","320px");if(b.find(".ds-icons-32 a").click(L),!X.deny_anonymous){var g=w.el.find("form");g.submit(function(){var i=g.find("input[name=author_email]").val();return !i&&!X.require_guest_email||i.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(p(ai.toJSON(g)),w.close(),!1):(alert("请输入一个有效的email地址."),!1)}),g.find("input[name=author_name]")[0].focus()}};X.deny_anonymous&&K.focus(function(){if(aT()){d(Y,G);var b=function(g){g.stopPropagation(),K.unbind("click",b)};K.click(b)}return !1});var G=function(b){A(Y),aj.post("posts/create",t.extend(ai.toJSON(Y),b),function(w){var g=aH[w.response.post_id]=new az(w.response),i=E(S.postList,g,X);if("asc"==X.order==("top"==X.formPosition)&&ai.scrollTo(i),I.data.comments++,I.updateCounter("duoshuo"),K.val("").trigger("keyup"),Z(Y),V.hasClass("ds-inline-replybox")&&(V.detach(),S.actionsBar.removeClass("ds-reply-active")),aZ){try{aZ.removeItem("ds_draft_"+I.threadId)}catch(p){}}},function(g){Z(Y),alert(g.errorMessage)})};Y.submit(function(){if(Y.data("submitting")){return !1}var b=t.trim(Y[0].message.value);return""==b||!am.placeholder&&b==K.attr("placeholder")?(alert("您还没写内容呢"),!1):(aT()?d(Y,G):G(),!1)});var B=function(b){return t(b).hasClass("ds-service-icon-grey")?null:t(b).attr("data-service")};if(at.click(function(){return t(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),f.value=t.map(at,B).join(","),f.checked=""!=f.value,!1}),t(f).change(function(){var b=this.checked;at[b?"removeClass":"addClass"]("ds-service-icon-grey")[b?"addClass":"removeClass"]("ds-service-icon"),this.value=t.map(at,B).join(",")}),!W&&aZ){var N="ds_draft_"+I.threadId;K.bind("focus blur keyup",function(g){var b=t(g.currentTarget).val();try{aZ[N]=b}catch(g){}}),aZ[N]&&K.val(aZ[N])}return this}},ax.Dialog=au.extend({init:function(d,b){(this.el=t("#ds-wrapper"))[0]||(this.el=F(t('<div id="ds-wrapper"></div>'))),this.options=t.extend({width:600},b),d!==aS&&t(d).attr("id","ds-reset").appendTo(this.el)},open:function(){function f(g){return 27==g.which?(b.close(),!1):void 0}function d(){return b.close(),!1}var b=this;return b.el.hide().appendTo(aR.body).fadeIn(200),am.ie6&&b.el.css("top",e.scrollTop()+100),b.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",function(){return b.close(),!1}).click(M),z.keydown(f),t(aR.body).click(d),b.close=function(){z.unbind("keydown",f),t(aR.body).unbind("click",d),b.el.fadeOut(200,function(){t(this).remove()}),b.trigger("close")},b}}),aV.likePanel=function(b){return b.likes?'<span class="ds-highlight">'+b.likes+"</span> 人喜欢":""},ax.Meta=function(b){this.embedThread=b},ax.Meta.prototype={render:function(){function f(d){function w(u){i.set(u),p.resetLikePanel()}function A(){p.tooltip.detach(),t(aR.body).unbind("click",A)}function l(u){switch(this.className){case"ds-like-tooltip-close":A(u);break;default:if(!a9.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no")){return}}return !1}var y=b.hasClass("ds-thread-liked");if(aj.post("threads/vote",{thread_id:p.embedThread.threadId,vote:y?0:1},w),b.toggleClass("ds-thread-liked"),b.find(".ds-thread-like-text").text(y?"喜欢":"已喜欢"),y){return p.tooltip&&A(d),!1}if(p.tooltip===aS){var n=aV.likeTooltip({services:{qzone:"QQ空间",weibo:"新浪微博",qqt:"腾讯微博",renren:"人人网",kaixin:"开心网",douban:"豆瓣网",baidu:"百度搜藏"},thread_id:i.data.thread_id});p.tooltip=t(n).click(M).delegate("a","click",l)}var x={};return x.left=0,x.top=g.position().top+g.outerHeight()-4+"px",p.tooltip.appendTo(p.embedThread.innerEl).css(x),t(aR.body).click(A),!1}var p=this,i=p.embedThread.model,g=p.el=t(aV.meta(i.toJSON())),b=g.find(".ds-like-thread-button");return b.click(f),p.resetLikePanel(),aT()&&g.hide(),p},resetLikePanel:function(){this.el.find(".ds-like-panel").html(aV.likePanel(this.embedThread.model.toJSON()))}},ax.PostListHead=function(b){this.embedThread=b},ax.PostListHead.prototype={render:function(){function p(n){l.find("a.ds-current").removeClass("ds-current"),b.params.page=1;var i=n.currentTarget;switch(i.className){case"ds-comments-tab-duoshuo":b.params.source="duoshuo",g.replybox.el.show();break;case"ds-comments-tab-repost":b.params.source="repost",g.replybox.el.hide();break;case"ds-comments-tab-weibo":b.params.source="weibo",g.replybox.el.hide();break;case"ds-comments-tab-qqt":b.params.source="qqt",g.replybox.el.hide()}return t(i).addClass("ds-current"),b.refetch(),!1}function f(){return u.find("a.ds-current").removeClass("ds-current"),b.params.order=g.options.order=this.className.replace("ds-order-",""),b.params.page=1,b.refetch(),t(this).addClass("ds-current"),!1}var g=this.embedThread,b=g.postList,d=this.el=t(aV.postListHead({thread:g.model.toJSON(),options:g.options})),l=d.find("ul.ds-comments-tabs");l.delegate(".ds-tab a","click",p);var u=d.find(".ds-sort");return u.delegate("a","click",f),u.find(".ds-order-"+b.params.order).addClass("ds-current"),this}},ax.Paginator=function(l){function f(){return d.params.page=parseInt(this.innerHTML),d.refetch(),b.find(".ds-current").removeClass("ds-current"),t(this).addClass("ds-current"),!1}l=l||{};var g=this,b=g.el=l.el||t('<div class="ds-paginator"></div>'),d=g.collection=l.collection;b.delegate("a","click",f)},ax.Paginator.prototype={reset:function(l){function f(i){d.push('<a data-page="'+i+'" href="javascript:void(0);">'+i+"</a>")}var g,b=this.collection.params.page||1,d=[];if(b>1){for(f(1),g=b>4?b-2:2,g>2&&d.push('<span class="page-break">...</span>');b>g;g++){f(g)}}if(d.push('<a data-page="'+b+'" href="javascript:void(0);" class="ds-current">'+b+"</a>"),b<l.pages){for(g=b+1;b+4>=g&&g<l.pages;g++){f(g)}g<l.pages&&d.push('<span class="page-break">...</span>'),f(l.pages)}this.el.html('<div class="ds-border"></div>'+d.join(" "))[l.pages>1?"show":"hide"]()}},ai.addSmilies=function(f,b){var d=ai.smiliesTooltip;d&&d.el.find("ul.ds-smilies-tabs").append("<li><a>"+f+"</a></li>"),ai.smilies[f]=b},ax.SmiliesTooltip=function(){},ax.SmiliesTooltip.prototype={render:function(){function f(){var u=d.replybox,g=u.el.find("textarea"),l=g[0],p=l.value;if(aR.selection){l.value=p.substring(0,g.data("ds-range-start"))+this.title+p.substring(g.data("ds-range-end"),p.length),l.value=l.value.replace(aB.leave_a_message,""),l.focus();var x=aR.selection.createRange();x.moveStart("character",g.data("ds-range-start")+this.title.length),x.collapse(),x.select()}else{var w=l.selectionStart+this.title.length;l.value=p.substring(0,l.selectionStart)+this.title+p.substring(l.selectionEnd),l.setSelectionRange(w,w)}u.hideSmilies(),l.focus()}var d=this,b=d.el=t(aV.smiliesTooltip(aq));return b.click(M).find("ul.ds-smilies-tabs").delegate("a","click",function(){d.reset(this.innerHTML)}),b.find(".ds-smilies-container").delegate("img","click",f),this},reset:function(g){function d(n,p){var l=0===g.indexOf("微博")?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+p.replace("_org","_thumb"):ai.STATIC_URL+"/images/smilies/"+p;"WordPress"===g&&(n=" "+n+" "),b+='<li><img src="'+l+'" title="'+be(n)+'" /></li>'}var f=this.el.find("ul.ds-smilies-tabs");f.find("a.ds-current").removeClass("ds-current"),f.find("a").filter(function(){return this.innerHTML==g}).addClass("ds-current");var b="<ul>";return t.each(aq[g],d),b+="</ul>",this.el.find(".ds-smilies-container").html(b),this}},aV.postPlaceholder=function(){return['<li class="ds-post ds-post-placeholder">',aB.no_comments_yet,"</li>"].join("")};var c=t('<div id="ds-bubble"><div class="ds-bubble-content"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>'),o=c.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",function(){function f(i){function g(n,l){return aV.ctxPost({post:n,index:l})}aC.log(t.map(i.response,g).join("\n"));d.el.find("ol");d.el.find("ol").html(t.map(i.response,g).join("\n"))}var b={};b.post_id=o.attr("data-post-id"),aj.get("posts/conversation",b,f);var d=aA('<h2>查看对话</h2><ol id="ds-ctx"></ol>');return d.el.find(".ds-dialog").css("width","600px"),d.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px","overflow-y":"auto","padding-top":"10px"}),!1}),a=bubbleOutTimer=0;c.mouseenter(m).mouseleave(r),ax.PostList=function(b){b&&(b.params&&(this.params=b.params),b.embedThread&&(this.embedThread=b.embedThread)),this.el=t('<ul class="ds-comments"></ul>')},ax.PostList.prototype={url:"threads/listPosts",render:function(){return h.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(d){var b=this.embedThread.options;this.el.html(d[0]?t.map(aH.getJSON(d),function(f){return aV.post({post:f,options:b})}).join(""):aV.postPlaceholder())},refetch:function(){function f(g){aH.set(g.parentPosts||g.relatedPosts),aF.set(g.users),d.reset(g.response),d.embedThread.paginator.reset(g.cursor),d.el.fadeTo(200,1),ai.scrollTo(d.el),b.remove()}var d=this,b=t(aV.indicator()).appendTo(aR.body).fadeIn(200);d.el.fadeTo(200,0.5),aj.get(d.url,d.params,f)}},ax.RelatedRead=function(){this._init()},ax.RelatedRead.prototype={uri:"base/recommend",mountedAfter:[".detail_main .detail_con .d_img p:last",".jun4_article .jun4_cententttt","#content p:last",".article .content p:last",".artcontent p:last",'.card_box p>[src="http://cpro.baidustatic.com/cpro/ui/cm.js"]:eq(2)',".mlrAuto .con_con p:last"],mountedBefore:[".artcontent .relateNews",".neirong_main .pagelist"],_init:function(){this.el=t('<div id="ds-related-reads"></div>'),this._count_timer=null},_unpackImages:function(g){for(var d,f=g.image_list.slice(0,3),b=[];f.length;){d=f.shift(),b.push(d.medium_image)}return b},_transform:function(g){for(var d=[],f=0,b=g.length;b>f;f++){d.push({url:g[f].url,title:g[f].title,type:g[f].type,source:g[f].source,imgs:this._unpackImages(g[f]),timeStamp:1000*g[f].publish_time,hasVideo:g[f].has_video,videoDuration:this._parseVideoDuration(g[f].video_duraion)})}return d},_parseVideoDuration:function(g){g=+g;var d=Math.floor(g/3600),f=Math.floor((g-60*d*60)/60),g=g-60*d*60-60*f,b=""+(d?(10>d?"0"+d:d)+" : ":"")+(10>f?"0"+f:f)+" : "+(10>g?"0"+g:g);return b},load:function(d){var b=this;aj.get(this.uri,{thread_id:d,url:a5.href},function(f){0==f.code?b.render(f.response):b.renderError()})},mount:function(g){var d=t(this.mountedAfter.join(","));if(d.length){try{return void this.el.insertAfter(d)}catch(f){}}var b=t(this.mountedBefore.join(","));if(b.length){try{return void this.el.insertBefore(b)}catch(f){}}g.append(this.el)},renderError:function(){},render:function(d){this.el.html(aV["related-read"](this._transform(d)));try{this.count()}catch(b){}},count:function(){var d=this;!function b(){clearTimeout(d._count_timer),d.el.find(".ds-reads-date").each(function(){var x,B,G,A,w,f,p=t(this).data("date"),g=(new Date).getTime(),y=g-p,u=new Date(p);y>86400000?(x=u.getFullYear(),B=u.getMonth()+1,G=u.getDate(),t(this).html(x+"年"+B+"月"+G+"日")):y>3600000?(A=Math.floor(y/60/60/1000),t(this).html(A+"小时前")):y>60000?(w=Math.floor(y/60/1000),t(this).html(w+"分钟前")):(f=Math.floor(y/1000),t(this).html(f+"秒前"))}),d._count_timer=setTimeout(b,60000)}()},stopCount:function(){clearTimeout(this._count_timer)}},ax.EmbedThread=al.extend({uri:"threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+(aP.match(/MSIE 6\.0/)?"":" title image thumbnail"),render:function(){var f=this.el;if("请将此处替换成文章在你的站点中的ID"===f.data("thread-key")){return alert("请设置正确的 data-thread-key 属性"),!1}f.attr("id","ds-thread").append(aV.waitingImg());var b=f.width(),d=f.data("url")||!f.attr("data-thread-id")&&t("link[rel=canonical]").attr("href");d?f.data("url",a1(d)):f.data("container-url",a5.href),b&&400>=b&&f.addClass("ds-narrow").data("max-depth",1)},updateCounter:function(l){function f(i){return i.substr(i.indexOf("}")+1)}var g={duoshuo:["comments",f(aB.comments_multiple)||"评论"],repost:["reposts",f(aB.reposts_multiple)||"转载"],weibo:["weibo_reposts",f(aB.weibo_reposts_multiple)||"新浪微博"],qqt:["qqt_reposts",f(aB.qqt_reposts_multiple)||"腾讯微博"]};for(var b in g){if(!l||l==b){var d=this.data[g[b][0]];this.el.find(".ds-comments-tab-"+b).html(this.el.hasClass("ds-narrow")?'<span class="ds-service-icon ds-'+b+'"></span>'+d:(d?'<span class="ds-highlight">'+d+"</span>":"0")+g[b][1])}}},onError:function(b){this.el.html("评论框出错啦("+b.code+"): "+b.errorMessage)},onload:function(l){var b=this,g=b.threadId=l.thread.thread_id,y=l.cursor,w=b.options=l.options,p=b.innerEl=F(t('<div id="ds-reset"></div>').appendTo(b.el));b.model=new ab(b.data=l.thread),aH.set(l.parentPosts||l.relatedPosts),aF.set(l.users),b.el.find("#ds-waiting").remove(),l.options&&l.options.show_recommend&&(b.relatedRead=new ax.RelatedRead,b.relatedRead.load(l.thread.thread_id),b.relatedRead.mount(p)),w.like_thread_enabled&&(b.meta=new ax.Meta(b),p.append(b.meta.render().el)),w.hot_posts&&l.hotPosts&&l.hotPosts.length&&(b.hotPosts=new ax.HotPosts(t('<div class="ds-rounded"></div>'),{max_depth:1,show_context:w.show_context}),b.hotPosts.thread=b,p.append(b.hotPosts.el),b.hotPosts.onload({list:aH.getJSON(l.hotPosts)})),b.postListHead=new ax.PostListHead(b),b.postList=new ax.PostList({embedThread:b,params:{source:"duoshuo",thread_id:g,max_depth:w.max_depth,order:w.order,limit:w.limit}}),b.postList.render().reset(l.response),b.paginator=new ax.Paginator({collection:b.postList}),b.paginator.reset(y);var x=b.replybox=new ax.Replybox(b);x.postList=b.postList.el,aT()?b.loginButtons=t(aV.loginButtons()).delegate("a.ds-more-services","click",function(){return b.loginButtons.find(".ds-additional-services").toggle(),!1}).delegate("a.ds-service-link","click",L):b.toolbar=t(aV.toolbar()).delegate(".ds-account-control","mouseenter",function(){t(this).addClass("ds-active")}).delegate(".ds-account-control","mouseleave",function(){t(this).removeClass("ds-active")}).delegate("a.ds-bind-more","click",function(){var d=aA(aV["dialog-bind-more"]()).el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px");return d.find("a.ds-service-link").click(L),!1}).delegate("a.ds-unread-comments-count","click",function(){return j("unread-comments"),!1});var f=['<a name="respond"></a>',b.toolbar||b.loginButtons,x.render().el];"top"==w.formPosition&&t.fn.append.apply(p,f),p.append(b.postListHead.render().el,b.postList.el,b.paginator.el),"bottom"==w.formPosition&&t.fn.append.apply(p,f),p.append(aV.poweredBy(w.poweredby_text)),b.updateCounter(),l.alerts&&t.each(l.alerts,function(i,d){t('<div class="ds-alert">'+d+"</div>").insertBefore(b.toolbar||loginButtons)}),w.message&&x.el.find("textarea").val(w.message).focus(),aI.on("reset",function(){var d=aI.data.comments||0;p.find("a.ds-unread-comments-count").html(d).attr("title",d?"你有"+d+"条新回复":"你没有新回复").css("display",d?"inline":"none")}),w.mzadx_id&&(ai.require("mzadxN",function(){}),t('<div id="MZADX_'+w.mzadx_id+'" style="margin:0 auto;"></div>').appendTo(p),__mz_rpq=a9.__mz_rpq||[],__mz_rpq.push({l:[w.mzadx_id],r:"1",_srv:"MZADX",_callback:function(){}})),ai.thread=b,aI.data!==aS&&aI.trigger("reset"),aT()||ap.send({visit_thread_id:b.threadId})},onMessage:function(b){E(this.postList.el,new az(b),this.options)}}),ax.HotPosts=al.extend({tmpl:"hotPosts",params:"show-quote",render:function(){return this.el.attr("id","ds-hot-posts"),this},onload:function(b){b.options=t.extend(this.options,b.options),al.prototype.onload.call(this,b),h.call(this.el.find("ul"),this.thread,this.options)}}),ax.RecentComments=al.extend({tmpl:"commentList",uri:"sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",render:function(){this.el.attr("id","ds-recent-comments")},prepare:function(b){return{list:t.map(b.response,function(d){return new az(d).toJSON()})}}}),ax.RecentVisitors=al.extend({tmpl:"recentVisitors",uri:"sites/listVisitors",params:"show-time avatar-size num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-recent-visitors").append(this.waitingEl=t(aV.waitingImg()))}}),ax.TopThreads=al.extend({tmpl:"topThreads",uri:"sites/listTopThreads",params:"range num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-top-threads").append(this.waitingEl=t(aV.waitingImg()))}}),ax.LoginWidget=al.extend({tmpl:"loginWidget",render:function(){var b=this.el;b.attr("id","ds-login").html(aV.loginWidget(["weixin","weibo","qq","renren","kaixin","douban"])),b.find("a").click(L),b.find("a.ds-logout").attr("href",aa.logoutUrl())}}),ax.ThreadCount=al.extend({onload:function(g){var d=this.el,f=d.data("count-type")||"comments",b=g.data[f];d[d.data("replace")?"replaceWith":"html"](aB[f+"_"+(b?b>1?"multiple":"one":"zero")].replace("{num}",b))}}),ax.ShareWidget=al.extend({tmpl:"shareWidget",render:function(){var b={copyright:"多说分享插件",services:["weibo","qzone","sohu","renren","netease","qqt","kaixin","douban","qq","meilishuo","mogujie","baidu","taobao","google","wechat","diandian","huaban","duitang","youdao","pengyou","facebook","twitter","linkedin","msn"]};this.el.attr("id","ds-share"),this.el.children().attr("id","ds-reset"),this.el.find(".ds-share-aside-inner").html(aV.shareWidget(b)),this.el.find(".ds-share-icons-more").html(aV.shareWidget(b)),this.el.find(".ds-share-icons-more").hide(),this.el.hasClass("flat")&&this.el.find("a").each(function(){t(this).addClass("flat")}),F(this.el),this.delegateEvents()},delegateEvents:function(){var p=this,g=p.el;if(g.children().hasClass("ds-share-inline")){var w=".ds-share-icons-more",A=g.find(w),x="[data-toggle=ds-share-icons-more]";g.delegate(x,"mouseover",function(){A.show()}),g.delegate(x,"mouseout",function(){A.hide()}),g.delegate(w,"mouseover",function(){A.show()}),g.delegate(w,"mouseout",function(){A.hide()})}else{var b=g.children().hasClass("ds-share-aside-left")?"slide-to-right":"slide-to-left",y=g.children();if(!aX.cssProperty("transition")){var f=g.children().hasClass("ds-share-aside-left")?"left":"right";g.delegate(".ds-share-aside-toggle","mouseover",function(){var i={},d=am.ie6&&"right"===f;d?i.left=(aR.documentElement.scrollLeft+aR.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)-195:i[f]=0,y.animate(i,200)}),g.delegate(".ds-share-aside-inner","mouseleave",function(){var i={},d=am.ie6&&"right"===f;d?i.left=(aR.documentElement.scrollLeft+aR.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)+230:i[f]=-229,y.animate(i,200)})}g.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseover",function(){y.addClass(b)}),g.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseleave",function(){y.removeClass(b)})}g.delegate("a","click",function(u){var B=t(this).data("service");if(!g.data("url")){return void alert("请设置data-url")}if("wechat"===B){var G=bd()+"/api/qrcode/getImage.png",I="?size=240&text="+g.data("url"),H=aA(aV["dialog-qrcode"]({qrcode_url:G+I,url:g.data("url")}));H.el.find(".ds-dialog").css("width","320px")}else{var i=bd()+"/share-proxy/?"+aX.param({service:t(this).data("service"),thread_key:g.data("threadKey"),title:g.data("title"),images:g.data("images"),content:g.data("content"),url:g.data("url")});a9.open(i,"_blank")}u.preventDefault(),u.stopPropagation()})}});var k=0;ai.initSelector=function(g,d){function f(i){ad(i),aX.extend(aB,i.options),ak.set(i.response)}var b=[];!aU()||!t.isReady&&a3||t(g).each(function(w,p){var l=t(p);if(!l.data("initialized")){l.data("initialized",!0);var u=new ax[d.type](l,d);if(ah.push(u),"ThreadCount"===d.type){var y=l.attr("data-thread-key");l.attr("data-channel-key")&&(y=l.attr("data-channel-key")+":"+y),b.push(y),ak[y]||(ak[y]=new ab({})),ak[y].on("reset",function(){u.onload(this)})}else{if(u.uri){var x={};t.each(u.params.split(" "),function(n,i){x[i.replace(/-/g,"_")]=l.attr("data-"+i)||l.data(i)}),aj.get(u.uri,D(x),function(i){u.load(i)})}}}}),b.length&&aj.get("threads/counts",D({threads:b.join(",")}),f)},(ai.initView=function(){t.each(an,ai.initSelector)})(),t(function(){if(!bb){if(!aU()){return aC.error("缺少 duoshuoQuery 的定义")}aC.warn("请在加载多说 embed.js 之前定义 duoshuoQuery")}setInterval(function(){t(".ds-time").each(function(){var b=t(this).attr("datetime");b&&(this.innerHTML=ai.elapsedTime(b))})},20000),bb.ondomready&&bb.ondomready(),ai.initView(),!k&&bb.short_name&&aj.get("analytics/ping",D({}),ad)})})}}(window,document);
